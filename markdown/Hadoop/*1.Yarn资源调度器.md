# Yarn资源调度器

Yarn是一个资源调度平台，负责为运算程序提供服务器运算资源，相当于一个分布式的操作系统平台，MapReduce是一个运行在这操作系统之上的应用程序



# Yarn基础架构

![image-20220721161359009](picture/image-20220721161359009.png)

四大组件如下：ResourceManager、NodeManager、ApplicationMaster 和 Container



## ResourceManager

**整个集群的老大**



1.处理客户端请求

2.监控NodeManager

3.启动或监控ApplicationMaster

4.资源的分配与调度



## NodeManager

**单个节点的老大**



1.管理单个节点上的资源

2.处理来自ResourceManager的命令

3.处理来自ApplicationMaster的命令



## ApplicationMaster

1.为应用程序申请资源并分配给内部的任务

2.任务的监控与容错



## Container

**容器**



Yarn中资源的抽象，它封装了某个节点上的多维度资源，比如内存、CPU、磁盘、网络等



# Yarn工作机制

![image-20220721162621591](picture/image-20220721162621591.png)

0.jar包提交到客户端所在的节点

1.客户端向ResourceManager申请Application

2.ResourceManager同意，并且返回资源提交路径和application_id

3.客户端提交job运行所需要的资源（如果是MR程序那就是split切片、jobxml和jar包）

4.资源提交完毕，申请运行mrAppMaster

5.ResourceManager将用户的请求初始化为一个Task，并放到任务队列里（FIFO调度队列）

6.闲置的NodeManager领取Task任务

7.创建容器Container，并执行MRAppMaster

8.下载job资源到本地（第3步提交的文件）

9.MRAppMaster向ResourceManager申请运行MapTask容器，RM将Task任务仍到调度队列里

10.闲置的NodeManager创建容器，领取任务（拷贝jar包）

11.MR AppMaster发起程序启动脚本，进程为YarnChild，执行代码

12.MapTask运行完毕，MRAppMaster向ResourceManager申请ReduceTask，进程为YarnChild

13.Reduce向Map获取分区数据

14.程序运行完毕MR AppMaster告诉ResourceManager释放资源



