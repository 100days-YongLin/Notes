# Hive安装

1.将jar包放置进/software

2.解压

```shell
tar -zxvf apache-hive-3.1.2-bin.tar.gz -C /opt/module/
```

3.进入module更名

```shell
mv apache-hive-3.1.2-bin/ hive
```

4.修改/etc/profile.d/my_env.sh，添加环境变量

```shell
sudo vim /etc/profile.d/my_env.sh
```

5.添加内容

```
#HIVE_HOME
export HIVE_HOME=/opt/module/hive
export PATH=$PATH:$HIVE_HOME/bin
```

6.source一下

```shell
source /etc/profile.d/my_env.sh
```

7.初始化元数据库

```
bin/schematool -dbType derby -initSchema
```

bin/schematool：初始化元数据库用的

bin/hive：在本地起一个客户端

bin/hiveserver2、bin/beeline：通过JDBC访问的



8.启动

```
bin/hive
```

9.查看日志

```
/tmp/userName
```

例如：/tmp/atguigu



怎么看日志？

如果报错了，先干掉

然后看tail -f hive.log往下打几行

再启动 就可以监控到新的日志



# Hive运行

Hive2版本 运行再Hadoop上 被视为是过时的版本，

默认引擎是MR，还能更改成Tez或Spark



查看数据库

```
show databases;
```



查看表

```
show tables;
```



建表，并查看表列表

```
create table test(id string);
show tables;
```



写数据

```
insert into test values('1001');
```



查看表

```
select * from test;
```



查看在HDFS里默认存储位置

/user/hive/warehouse/test



在 CRT 窗口中开启另一个窗口开启 Hive，在/tmp/atguigu 目录下监控 hive.log 文件

```
Caused by: ERROR XSDB6: Another instance of Derby may have already booted  the database /opt/module/hive/metastore_db. at  org.apache.derby.iapi.error.StandardException.newException(Unknown  Source) at  org.apache.derby.iapi.error.StandardException.newException(Unknown Source)
 at 
org.apache.derby.impl.store.raw.data.BaseDataFileFactory.privGetJBMSLockO
nDB(Unknown Source)
 at 
org.apache.derby.impl.store.raw.data.BaseDataFileFactory.run(Unknown 
Source)
...

```

原因在于 Hive 默认使用的元数据库为 derby，开启 Hive 之后就会占用元数据库，且不与 其他客户端共享数据，所以我们需要将 Hive 的元数据地址改为 MySQL。



# Hive元数据配置到MySQL

**1.将 MySQL 的 JDBC 驱动拷贝到 Hive 的 lib 目录下**

```
cp /opt/software/mysql-connector-java5.1.37.jar $HIVE_HOME/lib
```



**2.在$HIVE_HOME/conf 目录下新建 hive-site.xml 文件 添加如下内容**

```xml
<?xml version="1.0"?>
<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
<configuration>

 <!-- jdbc 连接的 URL -->
 <property>
     <name>javax.jdo.option.ConnectionURL</name>
     <value>jdbc:mysql://hadoop102:3306/metastore?useSSL=false</value>
</property>

 <!-- jdbc 连接的 Driver-->
 <property>
     <name>javax.jdo.option.ConnectionDriverName</name>
     <value>com.mysql.jdbc.Driver</value>
</property>

<!-- jdbc 连接的 username-->
 <property>
     <name>javax.jdo.option.ConnectionUserName</name>
     <value>root</value>
 </property>
 
 <!-- jdbc 连接的 password -->
 <property>
     <name>javax.jdo.option.ConnectionPassword</name>
     <value>000000</value>
</property>

 <!-- Hive 元数据存储版本的验证 -->
 <property>
     <name>hive.metastore.schema.verification</name>
     <value>false</value>
</property>

 <!--元数据存储授权-->
 <property>
     <name>hive.metastore.event.db.notification.api.auth</name>
     <value>false</value>
 </property>
 
 <!-- Hive 默认在 HDFS 的工作目录 -->
 <property>
     <name>hive.metastore.warehouse.dir</name>
     <value>/user/hive/warehouse</value>
 </property>
</configuration>

```



# 安装MySQL

**1.检查是否已经安装过MySQL**

```
[atguigu@hadoop102 ~]$ rpm -qa|grep mariadb
mariadb-libs-5.5.56-2.el7.x86_64 
//如果存在通过如下命令卸载
[atguigu @hadoop102 ~]$ sudo rpm -e --nodeps mariadb-libs
```



